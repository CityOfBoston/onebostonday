$(function(){$("form").on("submit",function(e){e.preventDefault();var t=Math.round(+new Date/1e3);$("#title").val(t);var o=$("form").serialize();$.ajax({url:"http://onebostonday-counter.hhcc.tech/",type:"POST",data:o,headers:{"X-Requested-With":"XMLHttpRequest"}}).done(function(){console.log("donezo")}).fail(function(){console.log("something went wrong")}).always(function(){console.log("complete")})});var e=function(e){var t=e,o=0;$.ajax({url:"http://siphon.hhcctech.com/api/container/showall/9",type:"GET"}).done(function(e){o=e.total+t.total_pledges;var n=o-1e3,a=document.querySelector("h1");od=new Odometer({el:a,value:n,format:"(,ddd)",duration:300}),od.update(o)}),$("button").on("click",function(){$("body").hasClass("thank-you")||(console.log(o),o++,od.update(o),$("body").addClass("thank-you"),setTimeout(function(){$("body").removeClass("thank-you")},3e3),$("form").submit())})};$.ajax({url:"http://onebostonday-counter.hhcc.tech/api/count",type:"GET"}).done(function(t){console.log("success"),e(t)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}),$(function(){function e(){return $(document).scrollTop()}var t=$("body");if(t.addClass("ready"),$(".intro button.watch-video").on("click",function(e){e.preventDefault();var o="5XLJabL_UfE";Modernizr.touchevents?(ga("send","event","celebrity video","mobile"),window.open("https://www.youtube.com/watch?v="+o,"_blank")):(ga("send","event","celebrity video","desktop"),$(".intro").prepend('<div class="video-player"><iframe src="https://www.youtube.com/embed/'+o+'?autoplay=1&rel=0&modestbranding=1" frameborder="0" allowfullscreen></iframe></div>'),t.append('<button class="close-video">Close video</div>'),setTimeout(function(){t.addClass("video-playing")},50),$("body").find("button.close-video").on("click",function(){t.removeClass("video-playing"),console.log("clicked"),setTimeout(function(){t.find("div.video-player").remove(),t.find("button.close-video").remove()},350)}))}),!Modernizr.touchevents&&$(window).width()>800){var o="";o+='<div class="bg-video">',o+="    <video autoplay loop muted>",o+='        <source src="/video/obd-short-2017.mp4" type="video/mp4">',o+='        <source src="/video/obd-short-2017.webm" type="video/webm">',o+="    </video>",o+="</div>",$("section.intro").append(o)}if(location.hash&&setTimeout(function(){var e=$(location.hash).offset().top;$("html,body").animate({scrollTop:e})},400),$(".acts-of-kindness h3").length>0){var n=document.querySelector(".acts-of-kindness h3");od=new Odometer({el:n,value:0,format:"(,ddd)",duration:2e3})}$(".video span").on("click",function(){ga("send","event","video","watched"),$(".video span").fadeOut(function(){$(".video img").remove(),$(".video").append('<iframe src="https://player.vimeo.com/video/206079468?autoplay=1" width="500" height="367" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')})}),$("form.planning-form").on("submit",function(e){e.preventDefault();var t=$(this).attr("action"),o=$(this).serialize();$.ajax({url:t,type:"POST",data:o}).done(function(){}).fail(function(){}).always(function(){$("form.planning-form").fadeOut(function(){$("section.planning .block").append('<div class="thank-you"><h3>Thank you for your submission.</h3> <p>It sounds like you are going to have an unforgetable One Boston Day!</p></div>'),$("section.planning").find(".thank-you").addClass("youre-welcome");var e=$("section.planning").offset().top;$("html,body").animate({scrollTop:e},500)})})}),$(".slider").slick({slide:".activity",dots:!0,infinite:!0,speed:300,slidesToShow:1,adaptiveHeight:!0,initialSlide:0,touchThreshold:3}),$(".activity .copy a").on("click",function(){ga("send","event","community learn more",$(this).attr("href"))}),$("button.tweet").on("click",function(){tweetValue=$(".craft textarea").val(),finalTweet=encodeURIComponent("For #OneBostonDay, "+tweetValue+" What will you do?"),tweetIntent="https://twitter.com/intent/tweet?text="+finalTweet+"&related=marty_walsh,notifyboston",g(tweetIntent,300,600)});var a=243;$(".craft span").text(a),$(".craft textarea").on("focus",function(){$(this).on("keyup",function(){var e=$(this).val().length,t=a-e;t<0?$(".craft span").html('<b class="nono">'+t+"</b>"):$(".craft span").text(t)})}),$(".craft-tweet button.tweet").on("click",function(){Modernizr.touch?ga("send","event","get involved","tweet clicked: mobile"):ga("send","event","get involved","tweet clicked: desktop -"+$(".craft span").html())});var s=function(){$.ajax({url:"/feed/feed.json",dataType:"json",error:function(e,t,o){},success:function(e){var t=e.results.length,o=e.results;setTimeout(function(){for(i=0;i<t;i++){var e=o[i];"twitter"===e.source?h(e.author_avatar_url,e.author_name,e.author_handle,e.created_at_long,e.id,e.post_message,e.post_media_url,"append"):"instagram"===e.source&&f(e.post_media_url,e.author_name,e.author_handle,e.created_at_long,e.instagram.link,e.post_message,"append")}},600),$(".social-feed .block > ul .content").anchorTextUrls(),$(window).width()<800?$(".social-feed .photo img").lazyload():$(".social-feed").find(".gutter-sizer").appendTo(".social-feed .block > ul"),setTimeout(function(){l()},2e3),setTimeout(function(){$(".load-more").click()},4e3),setTimeout(function(){$(".social-feed .photo img").lazyload({container:$(".social-feed .block > ul")})},2e3)}})},c=function(e,t){$(".feed .icon-spinner").fadeOut(function(){$(this).remove()});var o=e.data.length;o>500&&(o=500);var n=e.data;for("prepend"===t&&(n=n.reverse()),i=0;i<o;i++){var a=n[i];"twitter"===a.provider?h(a.userimageurl,a.full_name,a.username,a.created_at,a.social_id,a.message,a.image,t):"instagram"===a.provider&&f(a.image,a.full_name,a.username,a.created_at,a.social_id,a.message,t)}$(".social-feed .block > ul .content").anchorTextUrls(),$(window).width()<800?$(".social-feed .photo img").lazyload():($(".social-feed .photo img").lazyload({container:$(".social-feed .block > ul")}),$(".social-feed").find(".gutter-sizer").appendTo(".social-feed .block > ul"))},l=function(){$.ajax({url:"/oldfeed/feed.json",dataType:"json",error:function(e,t,o){},success:function(e){c(e,"append")}})};if($(".acts-of-kindness h3").length>0){s();var r=!1,d=43532;$.ajax({url:"http://one-boston-day-wayin-api.hhcctech.com/wayin/count.json",type:"GET",dataType:"json"}).done(function(e){console.log("success"),d=e.results[0].count}).fail(function(){console.log("error")}).always(function(){console.log("complete"),setInterval(function(){v(n)&&!1===r&&(od.update(d),r=!0)},500)})}var u=24;$("button.load-more").on("click",function(e){e.preventDefault(),$(".social-feed .block > ul > li:nth-child(-n+"+u+")").show(),u+=12,$(window).width()<800?$(".social-feed .photo img").lazyload():($(".social-feed").find(".gutter-sizer").appendTo(".social-feed .block > ul"),setTimeout(function(){$(".social-feed .block > ul").packery({itemSelector:".social-feed .block > ul > li",gutter:20})},250),setTimeout(function(){$(".social-feed .photo img").lazyload({container:$(".social-feed .block > ul")})},400)),0===$(".social-feed .block > ul").children(":hidden").length&&$("button.load-more").hide()}),$("body").on("click",".actions a",function(e){e.preventDefault(),g($(this).attr("href"),300,600),ga("send","event","feed twitter action",$(this).find("svg").attr("class"))});var h=function(e,t,o,n,a,i,s,c){var l=a.replace("tw-",""),r="https://twitter.com/intent/tweet?in_reply_to="+l,d="https://twitter.com/intent/retweet?tweet_id="+l,u="https://twitter.com/intent/favorite?tweet_id="+l;twitterDisplayImage="",null===s||s.includes("youtu")||(twitterDisplayImage='<div class="photo"><img data-original="'+s+'" src="/img/preloader-large.gif" alt=""></div>');var h=i;h=linkTwitterHashtags(h),h=linkTwitterUsers(h);var f=o.replace("@",""),m=n/1e3,p=(m.toString(),moment.unix(m).format("MMM Do YYYY h:mma"));isNaN(parseInt(n))&&(p=n);var v="";v+="<li>",v+='    <div class="twitter-card">',v+='        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>',v+="        <header>",v+='            <a href="https://twitter.com/'+o+'">',v+='                <img src="'+e+'">',v+="                <h4>"+t+"</h4>",v+="                <h5>@"+f+"</h5>",v+="            </a>",v+="        </header>",v+='        <div class="content">',v+="            <p>"+h+"</p>",v+="        </div>",v+='        <time><a target="_blank" href="https://twitter.com/'+o+"/status/"+l+'">'+p+"</a></time>",v+=twitterDisplayImage,v+='        <div class="actions">',v+="            <ul>",v+="                <li>",v+='                    <a class="reply" href="'+r+'"> ',v+='                        <svg class="icon icon-reply"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-reply"></use></svg>                ',v+="                    </a>",v+="                </li>",v+="                <li>",v+='                    <a class="retweet" href="'+d+'">',v+='                        <svg class="icon icon-retweet"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-retweet"></use></svg>',v+="                    </a> ",v+="                </li>",v+="                <li>",v+='                    <a class="favorite" href="'+u+'">',v+='                        <svg class="icon icon-heart"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-heart"></use></svg>',v+="                    </a>",v+="                </li>",v+="            </ul>",v+="        </div>",v+="    </div>",v+="</li>","append"===c?$(".social-feed .block > ul").append(v):$(".social-feed .block > ul").prepend(v),$(".social-feed header img").on("error",function(){$(this).parent().parent().parent().remove()})},f=function(e,t,o,n,a,i){var s=t;void 0!==typeof t&&0!==t.length||(s=o);var c=i.replace(/â€™/g,"’");c=linkInstagramHashtags(c),c=linkTwitterUsers(c);var l=n/1e3,r=(l.toString(),moment.unix(l).format("MMM Do YYYY h:mma")),d=o.replace("@",""),u="";u+="<li>",u+='    <div class="instagram-card">',u+='        <svg class="icon icon-instagram"><use xlink:href="#icon-instagram"></use></svg>',u+='    <div class="photo">',u+='        <img src="'+e+'"> ',u+="    </div>",u+='    <header class="insta-header">',u+='        <h4><a href="https://instagram.com/'+d+'">'+s+"</a></h4>",u+='        <a class="time" href="https://instagram.com/p/'+a+'" target="_blank" title=" '+n+' "></a>',u+="    </header>",u+='    <div class="content">',u+="        <p>"+c+"</p>",u+="    </div>",u+='        <time><a target="_blank" href="'+a+'">'+r+"</a></time>",u+="    </div>",u+="</li>",$(".social-feed .block > ul").append(u),$(".social-feed div.photo img").on("error",function(){$(this).parent().parent().remove()})};$(".burger-box").on("click",function(e){e.preventDefault(),$(this).hasClass("open")?($(this).removeClass("open").addClass("closed"),$(".main-nav").removeClass("active"),ga("send","event","mobile menu","close")):($(this).addClass("open").removeClass("closed"),$(".main-nav").addClass("active"),ga("send","event","mobile menu","open"))});var m=function(){$(".downloads li a").not(".none-download").each(function(){var e=$(this).data("image");$(this).css({"background-image":"url(../img/logos/"+e+")"}),$(this).attr("href","../img/logos/"+e),Modernizr.adownload||$(this).attr("target","_blank")}),$(".none-download").css({"background-image":"url(../img/"+$(".none-download").data("image")+")"}),Modernizr.touchevents&&$(".none-download").attr("href","/img/OneBostonDay_CoverPhoto_Facebook_v2.jpg")};if($(".downloads li a").on("click",function(){ga("send","event","logo download",$(this).data("image"))}),$("a.package").on("click",function(){ga("send","event","logo download","all .zip")}),$(".downloads").length>0)var p=setInterval(function(){e()>$(".downloads").offset().top-$(".downloads").height()&&(m(),clearInterval(p))},50);$('nav.story-nav input[type="checkbox"]').on("change",function(){$("div.story-list").toggleClass("hide-excerpts")}),$("section.photos ul.thumbs li").on("click",function(){$(this).parent().find("li").each(function(){$(this).removeClass("active")}),$(this).addClass("active"),$("section.photos div.holder").attr("style",$(this).attr("style"))}),$(window).on("scroll",function(){var t=e()+$(".main-nav").height();$("section").each(function(){offset=$(this).offset(),t>offset.top&&!$(this).hasClass("tracked")&&($(this).addClass("tracked"),ga("send","pageview",{page:"/"+$(this).attr("id"),title:$(this).attr("id")}))})}),$(".mayor .flickr").on("click",function(){window.open("https://www.flickr.com/people/bosmayorsoffice/","_blank"),ga("send","event","footer social",$(this).attr("class"))}),$(".mayor .twitter").on("click",function(){window.open("https://twitter.com/marty_walsh","_blank")}),$(".mayor .instagram").on("click",function(){window.open("https://www.instagram.com/boston_mayor/","_blank")}),$(".mayor button").on("click",function(){ga("send","event","footer social","mayor:"+$(this).attr("class"))}),$(".city .instagram").on("click",function(){window.open("https://instagram.com/cityofboston","_blank")}),$(".city .twitter").on("click",function(){window.open("https://twitter.com/CityofBoston","_blank")}),$(".city .facebook").on("click",function(){window.open("https://www.facebook.com/cityofboston","_blank")}),$(".city button").on("click",function(){ga("send","event","footer social","city:"+$(this).attr("class"))}),$(".cityofboston-link").on("click",function(){ga("send","event","footer link","city of boston website")}),$(".privacy-policy").on("click",function(){ga("send","event","footer link","privacy policy")}),$(".press a").on("click",function(){ga("send","event","press link",$(this).text())});var v=function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)};!function(){$("a[data-popup]").on("click",function(e){e.preventDefault(),window.open($(this)[0].href)})}();var g=function(e,t,o){return newwindow=window.open(e,"name","height="+t+",width="+o),window.focus&&newwindow.focus(),!1}}),$(function(){var e=function(){$.ajax({url:"http://one-boston-day-wayin-api.hhcctech.com/wayin/count.json",type:"GET"}).done(function(e){count=e.results[0].count;var t=document.querySelector("h1");od=new Odometer({el:t,value:count,format:"(,ddd)",duration:300}),od.update(count)})};setInterval(function(){e()},5e3),e()}),$(function(){var e=function(t){t.delay().fadeIn().delay(9e3).fadeOut(function(){e(t.next()),0===t.next().length&&($("main.tweets ul li").each(function(){$(this).remove()}),$("body").addClass("loading"),setTimeout(function(){a("http://one-boston-day-wayin-api.hhcctech.com/wayin/latest.json")},5e3))})},t=function(e){e.toString();return moment.unix(e).format("MMM Do YYYY h:mma")},o=function(e,o,n,a,i,s,c,l){twitterDisplayImage="",hasPhoto="",null===c||c.includes("youtube")||(twitterDisplayImage='<div class="photo" style="background-image:url('+c+')"></div>',hasPhoto="has-photo");var r=s;r=linkTwitterHashtags(r),r=linkTwitterUsers(r);var d=a/1e3,u="";u+="<li>",u+='    <div class="twitter-card '+hasPhoto+'">',u+='        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>',u+="        <header>",u+='            <a href="https://twitter.com/'+n+'">',u+='                <img src="'+e+'">',u+="                <h4>"+o+"</h4>",u+="                <h5>"+n+"</h5>",u+="            </a>",u+="        </header>",u+='        <div class="content">',u+="            <p>"+r+"</p>",u+="        </div>",u+='        <time><a href="https://twitter.com/'+n+"/status/"+i+'">'+t(d)+"</a></time>",u+=twitterDisplayImage,u+="    </div>",u+="</li>","append"===l?$("main.tweets > ul").append(u):$("main.tweets > ul").prepend(u)},n=function(e,t,o,n,a,i,s){var c=t;void 0!==typeof t&&0!==t.length||(c=o);var l=i.replace(/â€™/g,"’");l=linkInstagramHashtags(l),l=linkTwitterUsers(l);var r=n/1e3,d=(r.toString(),moment.unix(r).format("MMM Do YYYY h:mma")),u=o.replace("@",""),h="";h+="<li>",h+='    <div class="instagram-card">',h+='        <svg class="icon icon-instagram"><use xlink:href="#icon-instagram"></use></svg>',h+='    <div class="photo">',h+='        <img src="'+e+'"> ',h+="    </div>",h+='    <header class="insta-header">',h+='        <img src="'+s+'">',h+='        <h4><a href="https://instagram.com/'+u+'">'+c+"</a></h4>",h+='        <a class="time" href="https://instagram.com/p/'+a+'" target="_blank" title=" '+n+' "></a>',h+="    </header>",h+='    <div class="content">',h+="        <p>"+l+"</p>",h+="    </div>",h+='        <time><a target="_blank" href="'+a+'">'+d+"</a></time>",h+="    </div>",h+="</li>",$("main.tweets > ul").append(h)},a=function(t){$.ajax({url:t,dataType:"json",error:function(e,t,o){},success:function(t){$("body").removeClass("loading");var a=50,s=t.results;setTimeout(function(){for(i=0;i<a;i++){var t=s[i];console.log(t.source),"twitter"===t.source?o(t.author_avatar_url,t.author_name,t.author_handle,t.created_at_long,t.author_id,t.post_message,t.post_media_url,"append"):"instagram"===t.source&&n(t.post_media_url,t.author_name,t.author_handle,t.created_at_long,t.instagram.link,t.post_message,t.author_avatar_url)}e($("main.tweets ul li:first"))},600)}})};a("http://one-boston-day-wayin-api.hhcctech.com/wayin/latest.json")});