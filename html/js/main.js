$(function(){function t(){var t=$(document).scrollTop();return t}var e=$("body");e.addClass("ready");$(".main-nav ul a").on("click",function(t){if(ga("send","event","main navigation",$(this).text()),$(".press").length<=0){t.preventDefault();var e=$(this).attr("href"),i=$(e).offset().top-$(".main-nav").height();$("html,body").animate({scrollTop:i+"px"})}});var a='<iframe src="https://player.vimeo.com/video/124662459?autoplay=1" width="500" height="367" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';$(".video span").on("click",function(){ga("send","event","video","watched"),$(".video span").fadeOut(function(){$(".video img").remove(),$(".video").append(a),$(".video").fitVids()})}),$(".slider").slick({slide:".activity",dots:!0,infinite:!0,speed:300,slidesToShow:1,adaptiveHeight:!0,initialSlide:0,touchThreshold:3}),$(".activity .copy a").on("click",function(){ga("send","event","community learn more",$(this).attr("href"))});var o="For #OneBostonDay, ";$("button.tweet").on("click",function(){tweetValue=$(".craft textarea").val(),finalTweet=encodeURIComponent(o+tweetValue+" What will you do?"),tweetIntent="https://twitter.com/intent/tweet?text="+finalTweet+"&related=marty_walsh,notifyboston",u(tweetIntent,300,600)});var n=103;$(".craft span").text(n),$(".craft textarea").on("focus",function(){$(this).on("keyup",function(){var t=$(this).val().length,e=n-t;0>e?$(".craft span").html("Your tweet is too long :( <b>"+e+"</b>"):$(".craft span").text(e)})}),$(".craft-tweet button.tweet").on("click",function(){Modernizr.touch?ga("send","event","get involved","tweet clicked: mobile"):ga("send","event","get involved","tweet clicked: desktop -"+$(".craft span").html())});var s=function(t){$.ajax({url:"/feeds/"+t,dataType:"json",error:function(t,e,i){console.log(e,i)},success:function(t){$(".feed .icon-spinner").fadeOut(function(){$(this).remove()});var e=t.data.length;for(e>54&&(e=54),i=0;i<e;i++){var a=t.data[i];"twitter"===a.provider?c(a.userimageurl,a.full_name,a.username,a.created_at,a.social_id,a.message):"instagram"===a.provider&&r(a.image,a.full_name,a.username,a.created_at,a.social_id,a.message)}if($(window).width()<800?$(".feed img").lazyload():(console.log("lazy"),$(".feed img").lazyload({container:$(".feed ul")})),$(window).width()<800){$(".feed > ul").slick({slide:"li",dots:!0,arrows:!1,infinite:!1,speed:300,slidesToShow:1,slidesToScroll:1,rows:6,adaptiveHeight:!0,touchThreshold:3}),setTimeout(function(){$(".feed ul.slick-dots").clone().insertBefore($(".feed .slick-list")).addClass("above-dots")},300);var o=0;$(".feed > ul").on("swipe",function(t,e){ga("send","event","social feed","swipe: "+o),o++,$(".slick-dots.above-dots li").each(function(){$(this).removeClass("slick-active")}),$(".slick-dots.above-dots li:nth-child("+(e.currentSlide+1)+")").addClass("slick-active"),$('.slick-slide[data-slick-index="'+e.currentSlide+'"] img').each(function(){$(this).attr("src",$(this).data("original"))})}),$("body").on("click",".slick-dots.above-dots li",function(){var t=$(this).index()+1;$(".feed > ul").slick("slickGoTo",t),$(".slick-dots.above-dots li").each(function(){$(this).removeClass("slick-active")}),$(".slick-dots.above-dots li:nth-child("+t+")").addClass("slick-active")})}}})},l="";$.ajax({url:"/feeds",success:function(t){$(t).find("td > a").each(function(){l=$(this).attr("href")}),s("../feeds/feed.json")}}),$("body").on("click",".actions a",function(t){t.preventDefault(),u($(this).attr("href"),300,600),ga("send","event","feed twitter action",$(this).find("svg").attr("class"))});var c=function(t,e,i,a,o,n){var s="https://twitter.com/intent/tweet?in_reply_to="+o,l="https://twitter.com/intent/retweet?tweet_id="+o,c="https://twitter.com/intent/favorite?tweet_id="+o,r="";r+='<li class="twitter">',r+='    <div class="profile-image">',r+='        <img data-original="'+t+'" src="/img/preloader-small.gif">',r+="    </div>",r+='    <div class="tweet">',r+='        <header class="tweet-header">',r+="            <h4>"+e+"</h4>",r+='            <a class="handle" href="https://twitter.com/'+i+'" target="_blank">@'+i+"</a>",r+='            <a class="time" href="https://twitter.com/'+i+"/status/"+o+'" target="_blank" title=" '+a+' "></a>',r+="        </header>",r+='        <div class="tweet-entity">',r+="            <p>"+n+"</p>",r+="        </div>",r+="    </div>",r+='    <div class="actions">',r+="        <ul>",r+="            <li>",r+='                <a href="'+s+'">',r+='                    <svg class="icon icon-reply"><use xlink:href="#icon-reply"></use></svg>',r+="                </a>",r+="            </li>",r+="            <li>",r+='                <a href="'+l+'">',r+='                    <svg class="icon icon-retweet"><use xlink:href="#icon-retweet"></use></svg>',r+="                </a>",r+="            </li>",r+="            <li>",r+='                <a href="'+c+'">',r+='                    <svg class="icon icon-star"><use xlink:href="#icon-star"></use></svg>',r+="                </a>",r+="            </li>",r+="        </ul>",r+="    </div>",r+="</li>",$(".feed > ul").append(r),$(".feed a").timeago()},r=function(t,e,i,a,o,n){var s=e;(void 0===typeof e||0===e.length)&&(s=i);var l="";l+='<li class="instagram">',l+='    <img data-original="'+t+'" src="/img/preloader-large.gif"> ',l+='    <header class="insta-header">',l+='        <h4><a href="https://instagram.com/'+i+'">'+s+"</a></h4>",l+='        <a class="time" href="https://instagram.com/p/'+o+'" target="_blank" title=" '+a+' "></a>',l+="    </header>",l+="    <p>"+n+"</p>",l+="</li>",$(".feed > ul").append(l),$(".feed a").timeago()};$(".burger-box").on("click",function(t){t.preventDefault(),$(this).hasClass("open")?($(this).removeClass("open").addClass("closed"),$(".main-nav").removeClass("active"),ga("send","event","mobile menu","close")):($(this).addClass("open").removeClass("closed"),$(".main-nav").addClass("active"),ga("send","event","mobile menu","open"))});var d=function(){$(".downloads li a").each(function(){var t=$(this).data("image");$(this).css({"background-image":"url(../img/logos/"+t+")"}),$(this).attr("href","../img/logos/"+t),Modernizr.adownload||$(this).attr("target","_blank")})};$(".downloads li a").on("click",function(){ga("send","event","logo download",$(this).data("image"))}),$("a.package").on("click",function(){ga("send","event","logo download","all .zip")});var f=setInterval(function(){$(".press").length<=0&&t()>$(".downloads").offset().top-$(".downloads").height()&&(d(),clearInterval(f))},50);$(window).on("scroll",function(){var e=t()+$(".main-nav").height();$("section").each(function(){offset=$(this).offset(),e>offset.top&&!$(this).hasClass("tracked")&&($(this).addClass("tracked"),ga("send","pageview",{page:"/"+$(this).attr("id"),title:$(this).attr("id")}))})}),$(".mayor .flickr").on("click",function(){window.open("https://www.flickr.com/people/bosmayorsoffice/","_blank"),ga("send","event","footer social",$(this).attr("class"))}),$(".mayor .twitter").on("click",function(){window.open("https://twitter.com/marty_walsh","_blank")}),$(".mayor .facebook").on("click",function(){window.open("https://www.facebook.com/VoteMartyWalsh","_blank")}),$(".mayor button").on("click",function(){ga("send","event","footer social","mayor:"+$(this).attr("class"))}),$(".city .instagram").on("click",function(){window.open("https://instagram.com/notifyboston/","_blank")}),$(".city .twitter").on("click",function(){window.open("https://twitter.com/NotifyBoston","_blank")}),$(".city .facebook").on("click",function(){window.open("https://www.facebook.com/cityofboston","_blank")}),$(".city button").on("click",function(){ga("send","event","footer social","city:"+$(this).attr("class"))}),$(".cityofboston-link").on("click",function(){ga("send","event","footer link","city of boston website")}),$(".privacy-policy").on("click",function(){ga("send","event","footer link","privacy policy")}),$(".press a").on("click",function(){ga("send","event","press link",$(this).text())});var h=function(){$("a[data-popup]").on("click",function(t){t.preventDefault(),window.open($(this)[0].href)})};h();var u=function(t,e,i){return newwindow=window.open(t,"name","height="+e+",width="+i),window.focus&&newwindow.focus(),!1}});