{% extends '_layout' %}

{% set randomLogoArray = [
    'OneBostonDay_Logo_01_BlueNavy-square.jpg',
    'OneBostonDay_Logo_02_BlueWhite-square.jpg',
    'OneBostonDay_Logo_09_GreenBlue.jpg',
    'OneBostonDay_Logo_10_NavyWhite.jpg',
    'OneBostonDay_Logo_14_BlackWhiteTeal.jpg',
    'OneBostonDay_Logo_15_PurpleBlack.jpg',
    'OneBostonDay_Logo_13_TealBlack.jpg',
    'OneBostonDay_Logo_13_Rainbow.jpg',
    'OneBostonDay_Logo_11_YellowNavy.jpg',
    'OneBostonDay_Logo_08_GrayWhite.jpg',
    'OneBostonDay_Logo_07_Black.jpg',
    'OneBostonDay_Logo_06_GrayWhite.jpg',
    'OneBostonDay_Logo_04_BlueNavy.jpg'
] %}

{% block content %}
<main class="stories">
    <section class="header-intro">
        <h1>Stories</h1>
        <p>{{entry.introCopy}}</p>
    </section>

    <section class="stories">
        <div class="block">
            <p>{{entry.description}}</p>
            {# <nav class="story-nav">
                <div>
                    <label>
                        <span>Order:</span>
                        <div class="select-wrapper">
                            <select>
                                <option>Random</option>
                                <option>Alphabetically</option>
                            </select>
                        </div>
                    </label>
                </div>
                <div>
                    <label>
                        <span>Show Excerpts:</span>
                        <input type="checkbox" name="show-excerpts" checked>
                    </label>
                </div>
            </nav> #}

            {# TODO - Shuffle Stories #}
            <div class="story-list" id="stories-list">
                {% set stories = craft.entries.find({
                    section: 'stories',
                    with: ['galleryImages', 'questionsBlock']
                }) %}
                <ul>
                    {% for story in stories %}
                        {% set image = story.galleryImages[0] ?? null %}
                            {% set thumb = {
                                mode: 'crop',
                                width: 200,
                                quality: 80,
                                position: 'center-center'
                            } %}
                        <li>
                            <a href="/{{story.uri}}">
                                <div>
                                    {% if image %}
                                        <figure style="background-image:url({{image.getUrl(thumb)}}); background-position: {{ image.focusPctX }}% {{ image.focusPctY }}%;"></figure>
                                    {% else %}
                                        <figure style="background-image:url(/img/logos/{{random(randomLogoArray)}})"></figure>
                                    {% endif %}
                                    <h3>{{story.firstName}} {{story.lastName}}</h3>
                                    {% if story.onBehalfOf %}
                                        <h4>On Behalf of: {{story.onBehalfOf}}</h4>
                                    {% endif %}
                                </div>
                                {% if story.questionsBlock|length %}
                                {{story.questionsBlock[0].answer|slice(0,150)|raw}}...
                                {% else %}
                                    {{entry.customTextField|slice(0,150)|raw}}
                                {% endif %}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </section>
</main>
{% endblock %}